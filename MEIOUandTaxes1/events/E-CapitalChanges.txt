namespace = flavor_uef
namespace = capital_city

country_event = {
	id = flavor_uef.001
	
	title = "flavor_uef.001_title"
	desc = "flavor_uef.001_desc"
	picture = GREAT_BUILDING_eventPicture
	fire_only_once = yes
	is_triggered_only = yes
	
	option = {
		name = "flavor_uef.001.opta"
		trigger = {
				owns_core_province = 183
		}
		ai_chance = {
			factor = 30
		}
        Effect_set_capital = { target=183 }
    }
    option = {
		name = "flavor_uef.001.optb"
		trigger = {
				owns_core_province = 3375
		}
		ai_chance = {
			factor = 40
		}
        Effect_set_capital = { target=3375 }
    }
    option = {
		name = "flavor_uef.001.optc"
		trigger = {
				owns_core_province = 176
		}
		ai_chance = {
			factor = 5
		}
        Effect_set_capital = { target=176 }
    }
    option = {
		name = "flavor_uef.001.optd"
		trigger = {
				owns_core_province = 178
		}
		ai_chance = {
			factor = 10
		}
        name = "flavor_uef.001.optd"
        Effect_set_capital = { target=178 }
    }
    option = {
        name = "flavor_uef.001.opte"
		ai_chance = {
			factor = 15
		}
    }
}

#Event looking for a new capital city on loss of the previous capital, allowing for a change without the cost
#meant to fix vanilla AI putting new capitol city in a place with no residents and perspectives
country_event = {
	id = capital_city.001

	title = "EVT_AI"
	desc = "EVT_AI"
	picture = GREAT_BUILDING_eventPicture
	is_triggered_only = yes

	trigger = {
		ai = yes
		NOT = { is_colonial_nation = yes }
		capital_scope = { NOT = { check_key = { lhs = RE_Total value = 120 } } }
		OR = { 
			NOT = { has_country_flag = changed_capital_by_event }
			had_country_flag = {
				flag = changed_capital_by_event
				days = 2
			}
		}
	}

	immediate = {
		if = {
			limit = {
				capital_scope = { NOT = { check_key = { lhs = RE_Total value = 120 } } }
				any_owned_province = {
					culture = ROOT
					check_key = { lhs = RE_Total value = 120 }
				}
			}
			random_owned_province = {
				limit = {
					culture = ROOT
					check_key = { lhs = RE_Total value = 120 }
				}
				save_event_target_as = new_capital
			}
		}
		else_if = {
			limit = {
				capital_scope = { NOT = { check_key = { lhs = RE_Total value = 100 } } }
				any_owned_province = {
					culture = ROOT
					check_key = { lhs = RE_Total value = 100 }
				}
			}
			random_owned_province = {
				limit = {
					culture = ROOT
					check_key = { lhs = RE_Total value = 100 }
				}
				save_event_target_as = new_capital
			}
		}
		else_if = {
			limit = {
				capital_scope = { NOT = { check_key = { lhs = RE_Total value = 80 } } }
				any_owned_province = {
					culture = ROOT
					check_key = { lhs = RE_Total value = 80 }
				}
			}
			random_owned_province = {
				limit = {
					culture = ROOT
					check_key = { lhs = RE_Total value = 80 }
				}
				save_event_target_as = new_capital
			}
		}
		else_if = {
			limit = {
				capital_scope = { NOT = { check_key = { lhs = RE_Total value = 60 } } }
				any_owned_province = {
					culture = ROOT
					check_key = { lhs = RE_Total value = 60 }
				}
			}
			random_owned_province = {
				limit = {
					culture = ROOT
					check_key = { lhs = RE_Total value = 60 }
				}
				save_event_target_as = new_capital
			}
		}
		else_if = {
			limit = {
				capital_scope = { NOT = { check_key = { lhs = RE_Total value = 40 } } }
				any_owned_province = {
					culture = ROOT
					check_key = { lhs = RE_Total value = 40 }
				}
			}
			random_owned_province = {
				limit = {
					culture = ROOT
					check_key = { lhs = RE_Total value = 40 }
				}
				save_event_target_as = new_capital
			}
		}
		else_if = {
			limit = {
				capital_scope = { NOT = { check_key = { lhs = RE_Total value = 20 } } }
				any_owned_province = {
					culture = ROOT
					check_key = { lhs = RE_Total value = 20 }
				}
			}
			random_owned_province = {
				limit = {
					culture = ROOT
					check_key = { lhs = RE_Total value = 20 }
				}
				save_event_target_as = new_capital
			}
		}
		else_if = {
			limit = {
				capital_scope = { NOT = { check_key = { lhs = RE_Total value = 10 } } }
				any_owned_province = {
					culture = ROOT
					check_key = { lhs = RE_Total value = 10 }
				}
			}
			random_owned_province = {
				limit = {
					culture = ROOT
					check_key = { lhs = RE_Total value = 10 }
				}
				save_event_target_as = new_capital
			}
		}
		else_if = {
			limit = {
				capital_scope = { NOT = { check_key = { lhs = RE_Total value = 1 } } }
				any_owned_province = {
					culture = ROOT
					check_key = { lhs = RE_Total value = 1 }
				}
			}
			random_owned_province = {
				limit = {
					culture = ROOT
					check_key = { lhs = RE_Total value = 1 }
				}
				save_event_target_as = new_capital
			}
		}
	}

	option = {
		name = "EVT_AI"

		if = {
			limit = {
				has_saved_event_target = new_capital
			}
			log = "FE-CapitalChanges:[GetYear]:[Root.GetName]:changed capital from [Root.Capital.GetName] to [new_capital.GetName]:capital_city.001"
			set_capital = event_target:new_capital
		}
	}
}