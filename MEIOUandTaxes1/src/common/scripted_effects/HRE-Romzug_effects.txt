HRE_set_romzug_army_to_province = {
### call only from province scope
	if = {
		limit = {
			ERG = { check_key = { lhs = romzug_army_size_total value = 0 } }
		}
		
		if = {
			limit = {
				ERG = { 
					check_key = { lhs = romzug_army_size_total value = 1 }
					NOT = { check_key = { lhs = romzug_army_size_total value = 2 } }
				}
			}
			add_province_modifier = { name = HRE_romzug_army_1 duration = -1 }
		}
		if = {
			limit = {
				ERG = { 
					check_key = { lhs = romzug_army_size_total value = 2 }
					NOT = { check_key = { lhs = romzug_army_size_total value = 3 } }
				}
			}
			add_province_modifier = { name = HRE_romzug_army_2 duration = -1 }
		}
		if = {
			limit = {
				ERG = { 
					check_key = { lhs = romzug_army_size_total value = 3 }
					NOT = { check_key = { lhs = romzug_army_size_total value = 4 } }
				}
			}
			add_province_modifier = { name = HRE_romzug_army_3 duration = -1 }
		}
		if = {
			limit = {
				ERG = { 
					check_key = { lhs = romzug_army_size_total value = 4 }
					NOT = { check_key = { lhs = romzug_army_size_total value = 5 } }
				}
			}
			add_province_modifier = { name = HRE_romzug_army_4 duration = -1 }
		}
		if = {
			limit = {
				ERG = { 
					check_key = { lhs = romzug_army_size_total value = 5 }
					NOT = { check_key = { lhs = romzug_army_size_total value = 6 } }
				}
			}
			add_province_modifier = { name = HRE_romzug_army_5 duration = -1 }
		}
		if = {
			limit = {
				ERG = { 
					check_key = { lhs = romzug_army_size_total value = 6 }
					NOT = { check_key = { lhs = romzug_army_size_total value = 7 } }
				}
			}
			add_province_modifier = { name = HRE_romzug_army_6 duration = -1 }
		}
		if = {
			limit = {
				ERG = { 
					check_key = { lhs = romzug_army_size_total value = 7 }
					NOT = { check_key = { lhs = romzug_army_size_total value = 8 } }
				}
			}
			add_province_modifier = { name = HRE_romzug_army_7 duration = -1 }
		}
		if = {
			limit = {
				ERG = { 
					check_key = { lhs = romzug_army_size_total value = 8 }
					NOT = { check_key = { lhs = romzug_army_size_total value = 9 } }
				}
			}
			add_province_modifier = { name = HRE_romzug_army_8 duration = -1 }
		}
		if = {
			limit = {
				ERG = { 
					check_key = { lhs = romzug_army_size_total value = 9 }
					NOT = { check_key = { lhs = romzug_army_size_total value = 10 } }
				}
			}
			add_province_modifier = { name = HRE_romzug_army_9 duration = -1 }
		}
		if = {
			limit = {
				ERG = { 
					check_key = { lhs = romzug_army_size_total value = 10 }
					NOT = { check_key = { lhs = romzug_army_size_total value = 12 } }
				}
			}
			add_province_modifier = { name = HRE_romzug_army_10 duration = -1 }
		}
		if = {
			limit = {
				ERG = { 
					check_key = { lhs = romzug_army_size_total value = 12 }
					NOT = { check_key = { lhs = romzug_army_size_total value = 14 } }
				}
			}
			add_province_modifier = { name = HRE_romzug_army_12 duration = -1 }
		}
		if = {
			limit = {
				ERG = { 
					check_key = { lhs = romzug_army_size_total value = 14 }
					NOT = { check_key = { lhs = romzug_army_size_total value = 16 } }
				}
			}
			add_province_modifier = { name = HRE_romzug_army_14 duration = -1 }
		}
		if = {
			limit = {
				ERG = { 
					check_key = { lhs = romzug_army_size_total value = 16 }
					NOT = { check_key = { lhs = romzug_army_size_total value = 18 } }
				}
			}
			add_province_modifier = { name = HRE_romzug_army_16 duration = -1 }
		}
		if = {
			limit = {
				ERG = { 
					check_key = { lhs = romzug_army_size_total value = 18 }
					NOT = { check_key = { lhs = romzug_army_size_total value = 20 } }
				}
			}
			add_province_modifier = { name = HRE_romzug_army_18 duration = -1 }
		}
		if = {
			limit = {
				ERG = { 
					check_key = { lhs = romzug_army_size_total value = 20 }
					NOT = { check_key = { lhs = romzug_army_size_total value = 25 } }
				}
			}
			add_province_modifier = { name = HRE_romzug_army_20 duration = -1 }
		}
		if = {
			limit = {
				ERG = { 
					check_key = { lhs = romzug_army_size_total value = 25 }
					NOT = { check_key = { lhs = romzug_army_size_total value = 30 } }
				}
			}
			add_province_modifier = { name = HRE_romzug_army_25 duration = -1 }
		}
		if = {
			limit = {
				ERG = { 
					check_key = { lhs = romzug_army_size_total value = 30 }
					NOT = { check_key = { lhs = romzug_army_size_total value = 35 } }
				}
			}
			add_province_modifier = { name = HRE_romzug_army_30 duration = -1 }
		}
		if = {
			limit = {
				ERG = { 
					check_key = { lhs = romzug_army_size_total value = 35 }
					NOT = { check_key = { lhs = romzug_army_size_total value = 40 } }
				}
			}
			add_province_modifier = { name = HRE_romzug_army_35 duration = -1 }
		}
		if = {
			limit = {
				ERG = { 
					check_key = { lhs = romzug_army_size_total value = 40 }
					NOT = { check_key = { lhs = romzug_army_size_total value = 45 } }
				}
			}
			add_province_modifier = { name = HRE_romzug_army_40 duration = -1 }
		}
		if = {
			limit = {
				ERG = { 
					check_key = { lhs = romzug_army_size_total value = 45 }
					NOT = { check_key = { lhs = romzug_army_size_total value = 50 } }
				}
			}
			add_province_modifier = { name = HRE_romzug_army_45 duration = -1 }
		}
		if = {
			limit = {
				ERG = { 
					check_key = { lhs = romzug_army_size_total value = 50 }
					NOT = { check_key = { lhs = romzug_army_size_total value = 60 } }
				}
			}
			add_province_modifier = { name = HRE_romzug_army_50 duration = -1 }
		}
		if = {
			limit = {
				ERG = { 
					check_key = { lhs = romzug_army_size_total value = 60 }
					NOT = { check_key = { lhs = romzug_army_size_total value = 70 } }
				}
			}
			add_province_modifier = { name = HRE_romzug_army_60 duration = -1 }
		}
		if = {
			limit = {
				ERG = { 
					check_key = { lhs = romzug_army_size_total value = 70 }
					NOT = { check_key = { lhs = romzug_army_size_total value = 80 } }
				}
			}
			add_province_modifier = { name = HRE_romzug_army_70 duration = -1 }
		}
		if = {
			limit = {
				ERG = { 
					check_key = { lhs = romzug_army_size_total value = 80 }
					NOT = { check_key = { lhs = romzug_army_size_total value = 90 } }
				}
			}
			add_province_modifier = { name = HRE_romzug_army_80 duration = -1 }
		}
		if = {
			limit = {
				ERG = { 
					check_key = { lhs = romzug_army_size_total value = 90 }
					NOT = { check_key = { lhs = romzug_army_size_total value = 100 } }
				}
			}
			add_province_modifier = { name = HRE_romzug_army_90 duration = -1 }
		}
		if = {
			limit = {
				ERG = { 
					check_key = { lhs = romzug_army_size_total value = 100 }
					NOT = { check_key = { lhs = romzug_army_size_total value = 120 } }
				}
			}
			add_province_modifier = { name = HRE_romzug_army_100 duration = -1 }
		}
		if = {
			limit = {
				ERG = { 
					check_key = { lhs = romzug_army_size_total value = 120 }
					NOT = { check_key = { lhs = romzug_army_size_total value = 140 } }
				}
			}
			add_province_modifier = { name = HRE_romzug_army_120 duration = -1 }
		}
		if = {
			limit = {
				ERG = { 
					check_key = { lhs = romzug_army_size_total value = 140 }
					NOT = { check_key = { lhs = romzug_army_size_total value = 160 } }
				}
			}
			add_province_modifier = { name = HRE_romzug_army_140 duration = -1 }
		}
		if = {
			limit = {
				ERG = { 
					check_key = { lhs = romzug_army_size_total value = 160 }
					NOT = { check_key = { lhs = romzug_army_size_total value = 180 } }
				}
			}
			add_province_modifier = { name = HRE_romzug_army_160 duration = -1 }
		}
		if = {
			limit = {
				ERG = { 
					check_key = { lhs = romzug_army_size_total value = 180 }
					NOT = { check_key = { lhs = romzug_army_size_total value = 200 } }
				}
			}
			add_province_modifier = { name = HRE_romzug_army_180 duration = -1 }
		}
		if = {
			limit = {
				ERG = { 
					check_key = { lhs = romzug_army_size_total value = 200 }
				}
			}
			add_province_modifier = { name = HRE_romzug_army_200 duration = -1 }
		}
	}
}

HRE_remove_romzug_army = {
	hidden_effect = {
		trigger_switch = {
			on_trigger = has_province_modifier
			HRE_romzug_army_1   = { remove_province_modifier = HRE_romzug_army_1   }
			HRE_romzug_army_2   = { remove_province_modifier = HRE_romzug_army_2   }
			HRE_romzug_army_3   = { remove_province_modifier = HRE_romzug_army_3   }
			HRE_romzug_army_4   = { remove_province_modifier = HRE_romzug_army_4   }
			HRE_romzug_army_5   = { remove_province_modifier = HRE_romzug_army_5   }
			HRE_romzug_army_6   = { remove_province_modifier = HRE_romzug_army_6   }
			HRE_romzug_army_7   = { remove_province_modifier = HRE_romzug_army_7   }
			HRE_romzug_army_8   = { remove_province_modifier = HRE_romzug_army_8   }
			HRE_romzug_army_9   = { remove_province_modifier = HRE_romzug_army_9   }
			HRE_romzug_army_10  = { remove_province_modifier = HRE_romzug_army_10  }
			HRE_romzug_army_12  = { remove_province_modifier = HRE_romzug_army_12  }
			HRE_romzug_army_14  = { remove_province_modifier = HRE_romzug_army_14  }
			HRE_romzug_army_16  = { remove_province_modifier = HRE_romzug_army_16  }
			HRE_romzug_army_18  = { remove_province_modifier = HRE_romzug_army_18  }
			HRE_romzug_army_20  = { remove_province_modifier = HRE_romzug_army_20  }
			HRE_romzug_army_25  = { remove_province_modifier = HRE_romzug_army_25  }
			HRE_romzug_army_30  = { remove_province_modifier = HRE_romzug_army_30  }
			HRE_romzug_army_35  = { remove_province_modifier = HRE_romzug_army_35  }
			HRE_romzug_army_40  = { remove_province_modifier = HRE_romzug_army_40  }
			HRE_romzug_army_45  = { remove_province_modifier = HRE_romzug_army_45  }
			HRE_romzug_army_50  = { remove_province_modifier = HRE_romzug_army_50  }
			HRE_romzug_army_60  = { remove_province_modifier = HRE_romzug_army_60  }
			HRE_romzug_army_70  = { remove_province_modifier = HRE_romzug_army_70  }
			HRE_romzug_army_80  = { remove_province_modifier = HRE_romzug_army_80  }
			HRE_romzug_army_90  = { remove_province_modifier = HRE_romzug_army_90  }
			HRE_romzug_army_100 = { remove_province_modifier = HRE_romzug_army_100 }
			HRE_romzug_army_120 = { remove_province_modifier = HRE_romzug_army_120 }
			HRE_romzug_army_140 = { remove_province_modifier = HRE_romzug_army_140 }
			HRE_romzug_army_160 = { remove_province_modifier = HRE_romzug_army_160 }
			HRE_romzug_army_180 = { remove_province_modifier = HRE_romzug_army_180 }
			HRE_romzug_army_200 = { remove_province_modifier = HRE_romzug_army_200 }
		}
	}
}

HRE_spawn_romzug_army_infantry = {
	if = {
		limit = { mil_tech = 0 }
		while = {
			limit = {
				ERG = { check_key = { lhs = romzug_army_size_infantry value = 0 } }
			}
			
			subtract_key = { lhs = supplied_infantry value = 1 }
			
			random_owned_province = {
				limit = { NOT = { has_province_flag = was_occupied } }
				add_unit_construction = {
					type = imperial_estates_infantry_0
					amount = 1
					speed = 0.50
					cost = 0
				}	
			}
		}
	}
	if = {
		limit = { mil_tech = 10 }
		while = {
			limit = {
				ERG = { check_key = { lhs = romzug_army_size_infantry value = 0 } }
			}
			
			subtract_key = { lhs = supplied_infantry value = 1 }
			
			random_owned_province = {
				limit = { NOT = { has_province_flag = was_occupied } }
				add_unit_construction = {
					type = imperial_estates_infantry_10
					amount = 1
					speed = 0.50
					cost = 0
				}	
			}
		}
	}
	if = {
		limit = { mil_tech = 20 }
		while = {
			limit = {
				ERG = { check_key = { lhs = romzug_army_size_infantry value = 0 } }
			}
			
			subtract_key = { lhs = supplied_infantry value = 1 }
			
			random_owned_province = {
				limit = { NOT = { has_province_flag = was_occupied } }
				add_unit_construction = {
					type = imperial_estates_infantry_20
					amount = 1
					speed = 0.50
					cost = 0
				}	
			}
		}
	}
	if = {
		limit = { mil_tech = 30 }
		while = {
			limit = {
				ERG = { check_key = { lhs = romzug_army_size_infantry value = 0 } }
			}
			
			subtract_key = { lhs = supplied_infantry value = 1 }
			
			random_owned_province = {
				limit = { NOT = { has_province_flag = was_occupied } }
				add_unit_construction = {
					type = imperial_estates_infantry_30
					amount = 1
					speed = 0.50
					cost = 0
				}	
			}
		}
	}	
	if = {
		limit = { mil_tech = 40 }
		while = {
			limit = {
				ERG = { check_key = { lhs = romzug_army_size_infantry value = 0 } }
			}
			
			subtract_key = { lhs = supplied_infantry value = 1 }
			
			random_owned_province = {
				limit = { NOT = { has_province_flag = was_occupied } }
				add_unit_construction = {
					type = imperial_estates_infantry_40
					amount = 1
					speed = 0.50
					cost = 0
				}	
			}
		}
	}
	if = {
		limit = { 
			#has_country_flag = 
			mil_tech = 50 
		}
		while = {
			limit = {
				ERG = { check_key = { lhs = romzug_army_size_infantry value = 0 } }
			}
			
			subtract_key = { lhs = supplied_infantry value = 1 }
			
			random_owned_province = {
				limit = { NOT = { has_province_flag = was_occupied } }
				add_unit_construction = {
					type = imperial_estates_infantry_50
					amount = 1
					speed = 0.50
					cost = 0
				}	
			}
		}
	}

}

HRE_spawn_romzug_army_cavalry = {
	if = {
		limit = { mil_tech = 0 }
		while = {
			limit = {
				ERG = { check_key = { lhs = romzug_army_size_cavalry value = 0 } }
			}
			
			subtract_key = { lhs = supplied_cavalry value = 1 }
			
			random_owned_province = {
				limit = { NOT = { has_province_flag = was_occupied } }
				add_unit_construction = {
					type = imperial_estates_cavalry_0
					amount = 1
					speed = 0.50
					cost = 0
				}	
			}
		}
	}
	if = {
		limit = { mil_tech = 10 }
		while = {
			limit = {
				ERG = { check_key = { lhs = romzug_army_size_cavalry value = 0 } }
			}
			
			subtract_key = { lhs = supplied_cavalry value = 1 }
			
			random_owned_province = {
				limit = { NOT = { has_province_flag = was_occupied } }
				add_unit_construction = {
					type = imperial_estates_cavalry_10
					amount = 1
					speed = 0.50
					cost = 0
				}	
			}
		}
	}
	if = {
		limit = { mil_tech = 20 }
		while = {
			limit = {
				ERG = { check_key = { lhs = romzug_army_size_cavalry value = 0 } }
			}
			
			subtract_key = { lhs = supplied_cavalry value = 1 }
			
			random_owned_province = {
				limit = { NOT = { has_province_flag = was_occupied } }
				add_unit_construction = {
					type = imperial_estates_cavalry_20
					amount = 1
					speed = 0.50
					cost = 0
				}	
			}
		}
	}
	if = {
		limit = { mil_tech = 30 }
		while = {
			limit = {
				ERG = { check_key = { lhs = romzug_army_size_cavalry value = 0 } }
			}
			
			subtract_key = { lhs = supplied_cavalry value = 1 }
			
			random_owned_province = {
				limit = { NOT = { has_province_flag = was_occupied } }
				add_unit_construction = {
					type = imperial_estates_cavalry_30
					amount = 1
					speed = 0.50
					cost = 0
				}	
			}
		}
	}
	if = {
		limit = { mil_tech = 40 }
		while = {
			limit = {
				ERG = { check_key = { lhs = romzug_army_size_cavalry value = 0 } }
			}
			
			subtract_key = { lhs = supplied_cavalry value = 1 }
			
			random_owned_province = {
				limit = { NOT = { has_province_flag = was_occupied } }
				add_unit_construction = {
					type = imperial_estates_cavalry_40
					amount = 1
					speed = 0.50
					cost = 0
				}	
			}
		}
	}
	if = {
		limit = { mil_tech = 50 }
		while = {
			limit = {
				ERG = { check_key = { lhs = romzug_army_size_cavalry value = 0 } }
			}
			
			subtract_key = { lhs = supplied_cavalry value = 1 }
			
			random_owned_province = {
				limit = { NOT = { has_province_flag = was_occupied } }
				add_unit_construction = {
					type = imperial_estates_cavalry_50
					amount = 1
					speed = 0.50
					cost = 0
				}	
			}
		}
	}
}

HRE_spawn_romzug_army_artillery = {
	if = {
		limit = { mil_tech = 10 }
		while = {
			limit = {
				ERG = { check_key = { lhs = romzug_army_size_artillery value = 0 } }
			}
			
			subtract_key = { lhs = supplied_cavalry value = 1 }
			
			random_owned_province = {
				limit = { NOT = { has_province_flag = was_occupied } }
				add_unit_construction = {
					type = imperial_estates_artillery_10
					amount = 1
					speed = 0.50
					cost = 0
				}	
			}
		}
	}
	if = {
		limit = { mil_tech = 20 }
		while = {
			limit = {
				ERG = { check_key = { lhs = romzug_army_size_artillery value = 0 } }
			}
			
			subtract_key = { lhs = supplied_cavalry value = 1 }
			
			random_owned_province = {
				limit = { NOT = { has_province_flag = was_occupied } }
				add_unit_construction = {
					type = imperial_estates_artillery_20
					amount = 1
					speed = 0.50
					cost = 0
				}	
			}
		}
	}
	if = {
		limit = { mil_tech = 30 }
		while = {
			limit = {
				ERG = { check_key = { lhs = romzug_army_size_artillery value = 0 } }
			}
			
			subtract_key = { lhs = supplied_cavalry value = 1 }
			
			random_owned_province = {
				limit = { NOT = { has_province_flag = was_occupied } }
				add_unit_construction = {
					type = imperial_estates_artillery_30
					amount = 1
					speed = 0.50
					cost = 0
				}	
			}
		}
	}
	if = {
		limit = { mil_tech = 40 }
		while = {
			limit = {
				ERG = { check_key = { lhs = romzug_army_size_artillery value = 0 } }
			}
			
			subtract_key = { lhs = supplied_cavalry value = 1 }
			
			random_owned_province = {
				limit = { NOT = { has_province_flag = was_occupied } }
				add_unit_construction = {
					type = imperial_estates_artillery_40
					amount = 1
					speed = 0.50
					cost = 0
				}	
			}
		}
	}
	if = {
		limit = { mil_tech = 50 }
		while = {
			limit = {
				ERG = { check_key = { lhs = romzug_army_size_artillery value = 0 } }
			}
			
			subtract_key = { lhs = supplied_cavalry value = 1 }
			
			random_owned_province = {
				limit = { NOT = { has_province_flag = was_occupied } }
				add_unit_construction = {
					type = imperial_estates_artillery_50
					amount = 1
					speed = 0.50
					cost = 0
				}	
			}
		}
	}
}

HRE_Romzug_Eval_Escalation = {
	if = {
		limit = { check_key = { lhs = romzug_escalation_risk value = 100 } }
		
		emperor = { set_country_flag = HRE_Romzug_Escalation }	
	}
}

HRE_Romzug_start_conflict = {
	#mil_tech_at_war_start = yes
	set_country_flag = raised_special_units
	set_country_flag = imperial_estates_war_support
	set_country_flag = romzug_war
	
	event_target:Romzug_cur_location = {		
		HRE_spawn_romzug_army_infantry = yes
		HRE_spawn_romzug_army_cavalry = yes
		HRE_spawn_romzug_army_artillery = yes	
	}
			
	save_global_event_target_as = guelph_leader

	every_country = {
		limit = {
			has_country_flag = Hre_italy_guelfs 
			total_development = event_target:guelph_leader
		}
	
		save_global_event_target_as = guelph_leader
	}
	
	event_target:guelph_leader = {
	
		every_country = {
			limit = { has_country_flag = Hre_italy_ghibelines }
			create_alliance = emperor
		}
		every_country = {
			limit = { has_country_flag = Hre_italy_guelfs }
			create_alliance = guelph_leader
		}
		emperor = {
			declare_war_with_cb = {
				who = PREV
				casus_belli = cb_hre_romzug
			}
		}
	}
	
	clear_global_event_target = guelph_leader
}

HRE_Romzug_Eval_Next_Movement = {
	hidden_effect = {
		every_province = {
			limit = {
				has_province_flag = Romzug_cur_location
			}
			owner = {
				every_neighbor_country = {
					limit = {
						capital_scope = {
							OR = {
								region = central_italy_region
								region = west_italy_region
								region = east_italy_region
							}
						}
					}
					ERG = { change_key = { lhs = romzug_target_num value = 1 } }
					ROOT = { change_key = { lhs = romzug_target_id value = 1 } }
					
					set_key = { lhs = romzug_target_id which = ROOT }
					
					set_country_flag = Romzug_target_loc
				}
			}
			
		}
		
		HRE_Romzug_Eval_Next_Movement_Cities = { id = 1  }
		HRE_Romzug_Eval_Next_Movement_Cities = { id = 2  }
		HRE_Romzug_Eval_Next_Movement_Cities = { id = 3  }
		HRE_Romzug_Eval_Next_Movement_Cities = { id = 4  }
		HRE_Romzug_Eval_Next_Movement_Cities = { id = 5  }
		HRE_Romzug_Eval_Next_Movement_Cities = { id = 6  }
		HRE_Romzug_Eval_Next_Movement_Cities = { id = 7  }
		HRE_Romzug_Eval_Next_Movement_Cities = { id = 8  }
		HRE_Romzug_Eval_Next_Movement_Cities = { id = 9  }
		HRE_Romzug_Eval_Next_Movement_Cities = { id = 10 }
		
	}
}

HRE_Romzug_Eval_Next_Movement_Cities = {
	every_known_country = {
		limit = { 
			has_country_flag = Romzug_target_loc 
			is_key_equal = { lhs = romzug_target_id value = $id$ }
		}
		
		capital_scope = {
			save_global_event_target_as = Romzug_target_city_$id$
		}
	}
}